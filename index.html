<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <link href='https://fonts.googleapis.com/css?family=Chivo:900' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-dark.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <title>Byrtop10 by wzyuliyang</title>
  </head>

  <body>
    <div id="container">
      <div class="inner">

        <header>
          <h1>Byrtop10</h1>
          <h2>我的微信公共账号北邮人论坛历史10大</h2>
        </header>

        <section id="downloads" class="clearfix">
          <a href="https://github.com/wzyuliyang/byrTOP10/zipball/master" id="download-zip" class="button"><span>Download .zip</span></a>
          <a href="https://github.com/wzyuliyang/byrTOP10/tarball/master" id="download-tar-gz" class="button"><span>Download .tar.gz</span></a>
          <a href="https://github.com/wzyuliyang/byrTOP10" id="view-on-github" class="button"><span>View on GitHub</span></a>
        </section>

        <hr>

        <section id="main_content">
          <p>byrTOP10介绍 byrTOP10是一个Java Servlet 和 python Scrapy(0.24) 结合的一个微信公众帐号开发应用。功能是实现对北邮人论坛每日10大帖子的爬取后存入mysql数据库供微信公众号的检索。如输入20150831则会返回2015年8月31号的当日十大帖子。由于开发不久，数据库里的数据不多，记录日期重20150831开始，后续的数据库信息由scrapy和crontab每日定时6点30分开始爬去当日十大。</p>

<p><img src="http://i.imgur.com/nZNgLgf.png" alt=""></p>

<p><img src="http://i.imgur.com/rDJHDlT.jpg" alt=""></p>

<p>修改mysql数据库配置</p>

<pre><code>nano /etc/mysql/my.cnf 
#bind-address 127.0.0.1 
</code></pre>

<pre><code>sudo /etc/init.d/mysql restart #重启mysql
</code></pre>

<p>创建用户</p>

<pre><code>CREATE USER '****'@'localhost' IDENTIFIED BY '****';
CREATE USER '****'@'%' IDENTIFIED BY '****';
GRANT ALL ON *.* TO '****'@'localhost';
GRANT ALL ON *.* TO '****'@'%';
</code></pre>

<p>创建数据库</p>

<pre><code>CREATE DATABASE `TOP10` CHARACTER SET utf8 COLLATE utf8_general_ci;
</code></pre>

<p>建top10表</p>

<pre><code>python dataScrapy/t1/spiders/sp2.py
</code></pre>

<p>运行爬虫</p>

<pre><code>cd dataScrapy
scrapy crawl t2
</code></pre>

<h1>
<a id="修改datascrapy项目" class="anchor" href="#%E4%BF%AE%E6%94%B9datascrapy%E9%A1%B9%E7%9B%AE" aria-hidden="true"><span class="octicon octicon-link"></span></a>修改dataScrapy项目</h1>

<p>修改sp2.py 中的数据库用户名和密码</p>

<h1>
<a id="修改myjavaweb项目" class="anchor" href="#%E4%BF%AE%E6%94%B9myjavaweb%E9%A1%B9%E7%9B%AE" aria-hidden="true"><span class="octicon octicon-link"></span></a>修改myJavaWeb项目</h1>

<p>修改jdbcUtils.java 中的数据库用户名和密码
修改SignUtil.java 中的token</p>

<h1>
<a id="部署服务器" class="anchor" href="#%E9%83%A8%E7%BD%B2%E6%9C%8D%E5%8A%A1%E5%99%A8" aria-hidden="true"><span class="octicon octicon-link"></span></a>部署服务器</h1>

<pre><code>#修改apache-tomcat-7.0.57/conf/tomcat-users.xml 
&lt;tomcat-users&gt;
  &lt;role rolename="manager-gui"/&gt;
    &lt;role rolename="manager-script"/&gt;
    &lt;user username="tomcat" password="tomcat" roles="manager-gui, manager-script"/&gt;
&lt;/tomcat-users&gt;
</code></pre>

<pre><code>#修改maven settings.xml
&lt;servers&gt;
  &lt;server&gt;
    &lt;id&gt;Tomcat7&lt;/id&gt;
    &lt;username&gt;tomcat&lt;/username&gt;
    &lt;password&gt;tomcat&lt;/password&gt;
  &lt;/server&gt;
&lt;/servers&gt;
</code></pre>

<pre><code>cd myJavaWeb
#运行tomcat7
mvn tomcat7:deploy
</code></pre>

<h1>
<a id="增加爬虫定时任务-crontab" class="anchor" href="#%E5%A2%9E%E5%8A%A0%E7%88%AC%E8%99%AB%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1-crontab" aria-hidden="true"><span class="octicon octicon-link"></span></a>增加爬虫定时任务 crontab</h1>

<blockquote>
<p>由于是美国的VPS，所以改下时区</p>
</blockquote>

<pre><code>sudo dpkg-reconfigure tzdata #选取Asia Shanghai就可以了
</code></pre>

<pre><code>nano Top10.sh

#!/bin/bash
export PATH="/usr/local/bin:/usr/bin:/bin"
cd `dirname $0`
exec "$@"


</code></pre>

<pre><code>crontab -e 
</code></pre>

<pre><code>30 6 * * * /root/tomcat/dataScrapy/Top10.sh  scrapy crawl t2   #每天6点30分去爬论坛数据
</code></pre>
        </section>

        <footer>
          Byrtop10 is maintained by <a href="https://github.com/wzyuliyang">wzyuliyang</a><br>
          This page was generated by <a href="https://pages.github.com">GitHub Pages</a>. Tactile theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.
        </footer>

                  <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-56540551-2");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>

      </div>
    </div>
  </body>
</html>
